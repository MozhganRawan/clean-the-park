<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Clean the Park! üå≥üóë</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    font-family: Tahoma, sans-serif;
    background: linear-gradient(to top, #a8e6cf, #dcedc1);
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    color: #2c3e50;
    text-shadow: 1px 1px 4px black;
  }

  #game {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  h1 {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 2em;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  #bin {
    position: absolute;
    bottom: 20px;
    right: 20px;
    font-size: 4em;
    background: rgba(255,255,255,0.6);
    border-radius: 15px;
    padding: 5px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: transform 0.2s ease;
  }

  #bin.bump { transform: scale(1.3); }

  .trash {
    position: absolute;
    cursor: grab;
    user-select: none;
    transition: transform 0.2s, filter 0.2s;
  }

  .trash:hover { 
    transform: scale(1.2);
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.4));
  }

  .wiggle {
    animation: wiggle 0.3s infinite;
  }

  @keyframes wiggle {
    0% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
    100% { transform: rotate(-5deg); }
  }

  #level, #score, #recycled {
    position: absolute;
    left: 20px;
    font-size: 1.2em;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  }
  #level { top: 50px; }
  #score { top: 80px; }
  #recycled { top: 110px; }

  #message {
    position: absolute;
    top: 150px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.4em;
    text-align: center;
  }

  #paw {
    position: absolute;
    font-size: 3em;
    display: none;
    pointer-events: none;
  }
</style>
</head>
<body>
<div id="game">
  <h1>Clean the Park! üå≥üóë</h1>
  <div id="bin">üóë</div>
  <div id="level">Level: 1</div>
  <div id="score">Score: 0</div>
  <div id="recycled">Recycled: 0</div>
  <div id="message">Click anywhere to start!</div>
  <div id="paw">üêæ</div>
</div>

<script>
const game = document.getElementById("game");
const bin = document.getElementById("bin");
const levelEl = document.getElementById("level");
const scoreEl = document.getElementById("score");
const recycledEl = document.getElementById("recycled");
const messageEl = document.getElementById("message");
const paw = document.getElementById("paw");

const trashTypes = ["üçå","üçï","üí©","ü•ë","ü§°","ü•§","üçî","üçé","üç©"];

let state = {
  level: 1,
  score: 0,
  recycled: 0,
  trash: [],
  running: false,
  mouse: {x:0,y:0},
  animationId: null,
  nextLevelTimeout: null,
  musicStarted: false,
  draggingTrash: null
};

const Sounds = {
  start: new Audio("start.mp3"),
  drop: new Audio("drop.mp3"),
  levelUp: new Audio("level.mp3"),
  music: new Audio("bg-music.mp3")
};
Sounds.music.loop = true;

function playSound(name){
  if(Sounds[name]){
    const snd = Sounds[name].cloneNode();
    snd.load();
    snd.play().catch(e=>console.log("Sound play error:", e));
  }
}
function playMusic(){
  if(!state.musicStarted){
    Sounds.music.play().catch(e=>console.log("Music error:", e));
    state.musicStarted = true;
  }
}

function rand(min,max){ return Math.random()*(max-min)+min; }
function distance(x1,y1,x2,y2){ return Math.hypot(x2-x1,y2-y1); }

function createTrash(num){
  for(let i=0;i<num;i++){
    const el = document.createElement("div");
    el.className = "trash";
    el.textContent = trashTypes[Math.floor(Math.random()*trashTypes.length)];
    const size = rand(30,50);
    el.style.fontSize = size+"px";
    el.style.left = rand(50, window.innerWidth-100)+"px";
    el.style.top = rand(150, window.innerHeight-100)+"px";
    if(Math.random()<0.3) el.classList.add("wiggle");
    game.appendChild(el);

    const t = {el, size, x:parseFloat(el.style.left), y:parseFloat(el.style.top), vx:rand(-0.5,0.5), vy:rand(-0.5,0.5)};
    state.trash.push(t);
    enableDrag(t);
  }
}

function enableDrag(t){
  let offsetX, offsetY;
  t.el.addEventListener("mousedown", e=>{
    offsetX = e.clientX - t.el.offsetLeft;
    offsetY = e.clientY - t.el.offsetTop;

    function onMouseMove(e){
      t.x = e.clientX - offsetX;
      t.y = e.clientY - offsetY;
      t.el.style.left = t.x+"px";
      t.el.style.top = t.y+"px";
    }
    function onMouseUp(){
      document.removeEventListener("mousemove", onMouseMove);
      document.removeEventListener("mouseup", onMouseUp);
      checkDrop(t);
    }

    document.addEventListener("mousemove", onMouseMove);
    document.addEventListener("mouseup", onMouseUp);
  });

  t.el.addEventListener("touchstart", e=>{
    const touch = e.touches[0];
    state.draggingTrash = t;
    offsetX = touch.clientX - t.el.offsetLeft;
    offsetY = touch.clientY - t.el.offsetTop;
  });
}

game.addEventListener("touchmove", e=>{
  if(state.draggingTrash){
    const touch = e.touches[0];
    const t = state.draggingTrash;
    t.x = touch.clientX - 20;
    t.y = touch.clientY - 20;
    t.el.style.left = t.x+"px";
    t.el.style.top = t.y+"px";
  }
});

game.addEventListener("touchend", e=>{
  if(state.draggingTrash){
    checkDrop(state.draggingTrash);
    state.draggingTrash = null;
  }
});

function checkDrop(t){
  if(!t.el || !bin) return;
  const trashRect = t.el.getBoundingClientRect();
  const binRect = bin.getBoundingClientRect();

  const overlap = !(trashRect.right < binRect.left ||
                    trashRect.left > binRect.right ||
                    trashRect.bottom < binRect.top ||
                    trashRect.top > binRect.bottom);
  if(overlap){
    t.el.remove();
    state.trash = state.trash.filter(x=>x!==t);
    state.score += (t.size>36 ? 2 : 1);
    state.recycled++;
    scoreEl.textContent = "Score: "+state.score;
    recycledEl.textContent = "Recycled: "+state.recycled;

    bin.classList.add("bump");
    setTimeout(()=>bin.classList.remove("bump"),200);
    playSound("drop");

    if(state.trash.length===0) nextLevel();
  }
}

function nextLevel(){
  state.level++;
  levelEl.textContent = "Level: "+state.level;
  playSound("levelUp");
  messageEl.textContent = "Level up! New trash incoming...";
  setTimeout(()=>{
    messageEl.textContent = "";
    createTrash(3+state.level);
  }, 1200);
}

document.addEventListener("mousemove", e=>{
  state.mouse.x = e.clientX;
  state.mouse.y = e.clientY;
});

function moveTrash(){
  if(!state.running) return;
  state.trash.forEach(t=>{
    t.x += t.vx;
    t.y += t.vy;

    if(t.x<0||t.x>window.innerWidth-40) t.vx*=-1;
    if(t.y<100||t.y>window.innerHeight-40) t.vy*=-1;

    let d = distance(t.x,t.y,state.mouse.x,state.mouse.y);
    if(d<120){
      t.vx += (t.x-state.mouse.x)/d*0.05;
      t.vy += (t.y-state.mouse.y)/d*0.05;
    }

    t.vx = Math.max(-1.5, Math.min(1.5, t.vx));
    t.vy = Math.max(-1.5, Math.min(1.5, t.vy));

    t.el.style.left = t.x+"px";
    t.el.style.top = t.y+"px";
  });

  if(Math.random()<0.002) triggerChaos();
  state.animationId = requestAnimationFrame(moveTrash);
}

function triggerChaos(){
  paw.style.left = rand(50, window.innerWidth-100)+"px";
  paw.style.top = rand(150, window.innerHeight-100)+"px";
  paw.style.display = "block";
  setTimeout(()=>paw.style.display="none",800);
  state.trash.forEach(t=>{
    t.x = rand(50, window.innerWidth-100);
    t.y = rand(150, window.innerHeight-100);
  });
}

game.addEventListener("click", ()=>{
  if(!state.running && state.trash.length===0){
    state.running = true;
    playMusic();
    messageEl.textContent="";
    createTrash(3);
    moveTrash();
  }
});
</script>
</body>
</html>